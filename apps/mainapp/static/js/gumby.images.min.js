!function(){"use strict";function e(e){Gumby.debug("Initializing Responsive Images module",e);this.$el=e;this.type="";this.supports="";this.media="";this.def="";this.current="";this.setup();var t=this;$(window).on("load gumby.trigger "+(!this.media||"resize"),function(e){t.fire()});this.$el.on("gumby.initialize",function(){Gumby.debug("Re-initializing Responsive Images module",t.$el);t.setup();t.fire()});t.fire()}e.prototype.setup=function(){this.type=this.$el.is("img")?"img":"bg";this.supports=Gumby.selectAttr.apply(this.$el,["supports"])||false;this.media=Gumby.selectAttr.apply(this.$el,["media"])||false;this.def=Gumby.selectAttr.apply(this.$el,["default"])||false;if(this.supports){this.supports=this.parseAttr(this.supports)}if(this.media){this.media=this.parseAttr(this.media)}this.checks={supports:function(e){return Modernizr[e]},media:function(e){return window.matchMedia(e).matches}}};e.prototype.fire=function(){var e=false;if(this.supports&&Modernizr){e=this.handleTests("supports",this.supports)}if(this.media&&window.matchMedia&&!e){e=this.handleTests("media",this.media)}if(!e&&this.def){e=this.def}if(!e){return false}if(this.current!==e){this.current=e;this.insertImage(this.type,e)}};e.prototype.handleTests=function(e,t){var n=this,r=false;$(t).each(function(t,i){if(n.check(e,i.test)){r=i.img;return false}});return r};e.prototype.check=function(e,t){return this.checks[e](t)};e.prototype.insertImage=function(e,t){var n=this,r=$(new Image);r.load(function(){e==="img"?n.$el.attr("src",t):n.$el.css("background-image","url("+t+")");Gumby.debug("Triggering onChange event",t,n.$el);n.$el.trigger("gumby.onChange",[t])}).attr("src",t)};e.prototype.parseAttr=function(e){var t=this,n=e.split(","),r=[],i=[];$(n).each(function(e,n){i=n.split("|");if(i.length!==2){return true}r.push({test:t.shorthand(i[0]),img:i[1]})});return r};e.prototype.shorthand=function(e){if(e.indexOf(">")>-1||e.indexOf("<")>-1){e=e.replace(">","min-width: ").replace("<","max-width: ")}if(e.indexOf("width")>-1&&e.charAt(0)!=="("&&e.charAt(e.length-1)!==")"){e="("+e+")"}return e};Gumby.addInitalisation("images",function(t){$("[gumby-supports],[data-supports],[supports],[gumby-media],[data-media],[media]").each(function(){var n=$(this);if(n.data("isImage")&&!t){return true}else if(n.data("isImage")&&t){n.trigger("gumby.initialize");return true}n.data("isImage",true);new e(n)})});Gumby.UIModule({module:"images",events:["onChange","trigger"],init:function(){Gumby.initialize("images")}})}()